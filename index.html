<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>The Dart Room | Arcade Edition</title>

<style>
:root {
  --metal-bg: #1a1c1f;
  --panel-dark: #0d0e10;
  --gold: #ffcc33;
  --hazard-red: #ff3333;
  --hit-green: #44cc44;
  --hit-blue: #3366ff;
  --text-gold: #ffda6a;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  margin: 0; background-color: #050505; color: #fff;
  font-family: 'Oswald', 'Impact', sans-serif;
  /* Gritty Dark Den Texture */
  background-image: 
    radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.8) 100%),
    url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.08'/%3E%3C/svg%3E");
}

/* Header with Chrome finish */
.header {
  background: linear-gradient(180deg, #2c2f33 0%, #000 100%);
  padding: 15px; border-bottom: 2px solid #444; text-align: center;
  box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.header .title { font-size: 28px; font-weight: 900; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; text-shadow: 2px 2px 0px #000; }
.header .sub { font-size: 11px; color: #888; letter-spacing: 3px; }

.wrap { max-width: 500px; margin: 0 auto; padding: 15px; }

/* The Player Cards from your Photos */
.player-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
.player-card {
  background: linear-gradient(135deg, #222 0%, #0a0a0a 100%);
  border: 2px solid #333; border-radius: 8px; overflow: hidden;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
}
.player-card.active { border-color: var(--gold); box-shadow: 0 0 15px rgba(255,204,51,0.3); }
.player-header { background: #333; padding: 5px; text-align: center; font-weight: 900; text-transform: uppercase; border-bottom: 1px solid #444; }
.player-body { padding: 10px; text-align: center; }
.player-val { font-size: 32px; font-weight: 900; margin: 5px 0; color: #fff; }

/* 3D Arcade Buttons */
.arcade-btn {
  width: 100%; padding: 18px; border-radius: 6px; border: none;
  font-weight: 900; text-transform: uppercase; font-size: 16px; cursor: pointer;
  box-shadow: inset 0 2px 0 rgba(255,255,255,0.2), 0 4px 0 #000;
  margin-bottom: 10px; transition: transform 0.05s;
}
.arcade-btn:active { transform: translateY(3px); box-shadow: none; }

.btn-green { background: linear-gradient(180deg, #5de05d 0%, #2a8a2a 100%); color: #000; }
.btn-blue { background: linear-gradient(180deg, #5d8ee0 0%, #2a4e8a 100%); color: #fff; }
.btn-red { background: linear-gradient(180deg, #e05d5d 0%, #8a2a2a 100%); color: #fff; }
.btn-gray { background: linear-gradient(180deg, #666 0%, #222 100%); color: #ccc; }

/* Glowing Dartboard */
.board-container { 
    position: relative; margin: 20px auto; width: 220px; 
    filter: drop-shadow(0 0 20px rgba(255,150,0,0.4));
}
@keyframes fire-glow { 0%, 100% { filter: brightness(1) drop-shadow(0 0 10px orange); } 50% { filter: brightness(1.2) drop-shadow(0 0 25px gold); } }
.board-container.hot { animation: fire-glow 2s infinite ease-in-out; }

</style>
</head>

<body>
<div class="header">
    <div class="title" id="gameTitle">SHANGHAI</div>
    <div class="sub">THE DART ROOM</div>
</div>

<div class="wrap" id="app">
    <div style="text-align: center; padding: 50px;">BOOTING SYSTEM...</div>
</div>

<script>
/* REPAIRED ENGINE + ARCADE SKIN */
function loadScript(src){
  return new Promise((resolve,reject)=>{
    const s=document.createElement("script"); s.src=src; s.async=true;
    s.onload=resolve; s.onerror=reject;
    document.head.appendChild(s);
  });
}

const appEl=document.getElementById("app");

// Arcade Dartboard SVG
function drawBoard(target){
  const cx=100, cy=100, rOuter=85;
  const isHot = target ? "hot" : "";
  return `
    <div class="board-container ${isHot}">
      <svg viewBox="0 0 200 200">
        <circle cx="100" cy="100" r="${rOuter}" fill="#111" stroke="#444" stroke-width="3"/>
        <circle cx="100" cy="100" r="12" fill="#228b22" />
        <circle cx="100" cy="100" r="6" fill="#b22222" />
        <text x="100" y="105" font-size="10" text-anchor="middle" fill="white" font-weight="bold">${target||""}</text>
      </svg>
    </div>`;
}

async function boot(){
  try {
    await loadScript("https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js");
    await loadScript("https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js");
    await loadScript("https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js");
    startApp();
  } catch(e) { appEl.innerHTML="HARDWARE ERROR"; }
}

function startApp(){
  const config = { apiKey: "AIzaSyCY3hTUNNlV6gAofPXY9BVGKb930WYz5RA", authDomain: "gamenightdarts-e7601.firebaseapp.com", projectId: "gamenightdarts-e7601" };
  firebase.initializeApp(config);
  const db = firebase.firestore();

  let meUser = null;
  let screen = "auth";
  let match = null;

  function render(){
    appEl.innerHTML = "";
    if(screen === "auth") renderAuth();
    if(screen === "home") renderHome();
    if(screen === "play") renderPlay();
  }

  function renderAuth(){
    appEl.innerHTML = `
      <div class="player-card" style="padding: 20px;">
        <h2 style="color:var(--gold); margin-top:0;">LOGIN</h2>
        <input type="email" id="emailIn" placeholder="EMAIL" style="width:100%; padding:15px; background:#000; color:white; border:1px solid #444; margin-bottom:15px;">
        <button class="arcade-btn btn-green" id="loginBtn">ENTER ENGINE</button>
      </div>`;
    document.getElementById("loginBtn").onclick = async () => {
      const email = document.getElementById("emailIn").value.toLowerCase().trim();
      if(!email) return;
      const doc = await db.collection("players").doc(email).get();
      meUser = doc.exists ? doc.data() : { email, name: email.split('@')[0].toUpperCase() };
      if(!doc.exists) await db.collection("players").doc(email).set(meUser);
      screen = "home"; render();
    };
  }

  function renderHome(){
    appEl.innerHTML = `
      <div class="player-card" style="margin-bottom: 20px;">
        <div class="player-header">CURRENT USER</div>
        <div class="player-body"><h3>${meUser.name}</h3></div>
      </div>
      <button class="arcade-btn btn-blue" id="startSh">SHANGHAI MODE</button>
      <button class="arcade-btn btn-red" id="startK">KILLER MODE</button>`;
    
    document.getElementById("startSh").onclick = () => {
      match = { players: [meUser, {name: "MIKE", email:"m@m.com"}], turnIndex: 0, targetIndex: 0, dartInTurn: 0, targets: [20,19,18,17,16,15,"B"], gameId: "SHANGHAI" };
      screen = "play"; render();
    };
  }

  function renderPlay(){
    const p = match.players[match.turnIndex];
    const t = match.targets[match.targetIndex];
    document.getElementById("gameTitle").innerText = match.gameId;

    appEl.innerHTML = `
      <div style="text-align:center; margin-bottom:10px; color:var(--gold); font-weight:bold;">
        TURN: ${p.name} | DART: ${match.dartInTurn + 1}/3
      </div>
      
      ${drawBoard(t)}

      <div class="player-grid">
        <div class="player-card ${match.turnIndex === 0 ? 'active' : ''}">
            <div class="player-header">YOU</div>
            <div class="player-body"><div class="player-val">42</div></div>
        </div>
        <div class="player-card ${match.turnIndex === 1 ? 'active' : ''}">
            <div class="player-header">MIKE</div>
            <div class="player-body"><div class="player-val">39</div></div>
        </div>
      </div>

      <div class="hit-grid">
        <button class="arcade-btn btn-green" onclick="window.handleHit(1)">TRIPLE</button>
        <button class="arcade-btn btn-blue" onclick="window.handleHit(1)">SINGLE</button>
        <button class="arcade-btn btn-gray" onclick="window.handleHit(1)">DOUBLE</button>
        <button class="arcade-btn btn-red" onclick="window.handleHit(0)">MISS</button>
      </div>`;
  }

  window.handleHit = (val) => {
    match.dartInTurn++;
    if(match.dartInTurn >= 3){
      match.dartInTurn = 0;
      match.turnIndex = (match.turnIndex + 1) % match.players.length;
      if(match.turnIndex === 0) match.targetIndex++;
    }
    if(match.targetIndex >= match.targets.length) { screen="home"; }
    render();
  };

  render();
}
boot();
</script>
</body>
</html>
