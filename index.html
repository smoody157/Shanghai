<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Night Darts</title>
  <style>
    :root{
      --bg:#0b1a2e;
      --panel:#122746;
      --panel2:#163155;
      --line:#244266;
      --text:#eaf2ff;
      --muted:#b9cbe5;
      --accent:#4ea8ff;
      --accent2:#2b7bff;
      --danger:#ff4d5a;
      --ok:#2bd576;
      --btn:#2a4f7a;
      --btn2:#1f4166;
      --shadow: rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:radial-gradient(1200px 700px at 40% 0%, #10335f 0%, var(--bg) 55%);color:var(--text)}
    a{color:var(--accent)}
    .topbar{
      position:sticky;top:0;z-index:10;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 14px;background:rgba(10,20,35,.75);backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand{display:flex;flex-direction:column;line-height:1.05}
    .brand .t{font-weight:900;font-size:16px;letter-spacing:.02em}
    .brand .s{font-size:12px;color:var(--muted)}
    .top-actions{display:flex;gap:10px;align-items:center}
    .btn{
      border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg,var(--btn),var(--btn2));
      color:var(--text);border-radius:14px;padding:10px 12px;font-weight:900;
      box-shadow:0 6px 16px var(--shadow);
    }
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent;box-shadow:none;color:var(--muted)}
    .btn.danger{background:linear-gradient(180deg,#ff5966,#d73643)}
    .btn.ok{background:linear-gradient(180deg,#3be39a,#1fb55d);color:#041b11}
    .wrap{max-width:720px;margin:0 auto;padding:14px}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;padding:14px;
      box-shadow:0 10px 28px rgba(0,0,0,.28);
      margin-bottom:12px;
    }
    .center{display:flex;flex-direction:column;align-items:center;text-align:center}
    .h1{font-size:26px;font-weight:1000;margin:2px 0 6px}
    .sub{color:var(--muted);font-size:13px}
    label{display:block;color:var(--muted);font-size:12px;margin-bottom:6px}
    input, select{
      width:100%;
      background:rgba(10,20,35,.65);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      border-radius:14px;padding:12px 12px;font-size:16px;outline:none;
    }
    .row{display:flex;gap:10px;align-items:stretch}
    .row > *{flex:1}
    .stack{display:flex;flex-direction:column;gap:10px}
    .toast{
      background:rgba(255,77,90,.12);
      border:1px solid rgba(255,77,90,.30);
      color:#ffd6da;
      border-radius:14px;padding:10px 12px;font-weight:900;margin-bottom:12px;
    }
    .note{
      background:rgba(78,168,255,.10);
      border:1px solid rgba(78,168,255,.26);
      color:#d7ecff;
      border-radius:14px;padding:10px 12px;font-weight:900;margin-bottom:12px;
    }
    .pill{
      display:inline-block;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(78,168,255,.08);
      color:var(--accent);
      font-weight:900;font-size:12px;
    }
    .divider{height:1px;background:rgba(255,255,255,.10);margin:12px 0}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .small{font-size:12px;color:var(--muted)}
    .big{font-size:28px;font-weight:1000}
    .muted{color:var(--muted)}
    .kpi{display:flex;gap:10px;flex-wrap:wrap}
    .kpi .box{flex:1;min-width:140px;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:10px}
    .kpi .box .v{font-weight:1000;font-size:20px}
    .kpi .box .l{font-size:12px;color:var(--muted)}
    .list{display:flex;flex-direction:column;gap:10px}
    .li{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border-radius:16px;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.10)}
    .li .meta{display:flex;flex-direction:column;gap:2px}
    .li .meta .nm{font-weight:1000}
    .li .meta .em{font-size:12px;color:var(--muted)}
    .li .right{display:flex;gap:8px}
    /* Play layout */
    .playWrap{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){ .playWrap{grid-template-columns:1.1fr .9fr} }
    .boardCard{padding:12px}
    .boardHeader{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
    .turnPill{background:rgba(43,123,255,.14);border:1px solid rgba(43,123,255,.30);color:#d7ecff;padding:6px 10px;border-radius:999px;font-weight:1000;font-size:12px}
    .dartboardBox{
      width:100%;
      aspect-ratio:1/1;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:radial-gradient(circle at 50% 40%, rgba(78,168,255,.10), rgba(0,0,0,.12) 55%, rgba(0,0,0,.22));
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
      box-shadow: inset 0 0 40px rgba(0,0,0,.35);
    }
    .controlsCard{padding:12px}
    .hitRow{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .hitBtn{
      border-radius:16px;
      padding:14px 10px;
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(180deg,rgba(78,168,255,.18),rgba(20,35,60,.35));
      color:var(--text);
      font-weight:1000;
      font-size:16px;
      box-shadow:0 10px 24px rgba(0,0,0,.25);
    }
    .hitBtn:active{transform:translateY(1px)}
    .hitBtn.miss{background:linear-gradient(180deg,rgba(255,77,90,.18),rgba(20,35,60,.35))}
    .hitBtn.undo{background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(20,35,60,.35));color:var(--muted)}
    .hitBtn.next{background:linear-gradient(180deg,rgba(43,213,118,.22),rgba(20,35,60,.35))}
    .log{
      margin-top:10px;
      background:rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:10px;
      min-height:84px;
    }
    .logLine{display:flex;justify-content:space-between;gap:10px;font-size:13px;color:var(--muted);padding:4px 0;border-bottom:1px dashed rgba(255,255,255,.08)}
    .logLine:last-child{border-bottom:none}
    .scoreTable{
      margin-top:10px;
      overflow:auto;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
    }
    table{border-collapse:collapse;width:100%;min-width:520px;background:rgba(0,0,0,.14)}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:center}
    th{font-size:12px;color:var(--muted);font-weight:1000;background:rgba(255,255,255,.05);position:sticky;top:0}
    td.l{text-align:left}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.14);font-size:12px;color:var(--muted)}
    .activeCell{outline:2px solid rgba(78,168,255,.55);outline-offset:-2px;border-radius:10px}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <div class="t">Game Night Darts</div>
      <div class="s">The Dart Room presents • Developed & designed by Steve’s Graphic Designs</div>
    </div>
    <div class="top-actions">
      <button class="btn ghost" id="homeBtn" type="button">Home</button>
      <button class="btn ghost" id="signOutBtn" type="button" style="display:none;">Sign out</button>
    </div>
  </div>

  <div class="wrap" id="app"></div>

<script>
/* ========= STORAGE (LOCAL ONLY) =========
   This file runs fully without Firebase.
   If you later want global players across devices, you’ll need to wire Firestore.
*/
const LS = {
  players: "gnd_players_v1",
  sessionEmail: "gnd_session_email_v1",
  stats: "gnd_stats_v1",
  history: "gnd_history_v1"
};

function readJSON(key, fallback){
  try{ return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }catch{ return fallback; }
}
function writeJSON(key, value){
  localStorage.setItem(key, JSON.stringify(value));
}
function now(){ return Date.now(); }
function normEmail(s){ return (s||"").trim().toLowerCase(); }
function esc(s){ return String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"); }

function getPlayers(){ return readJSON(LS.players, []); }
function savePlayers(players){ writeJSON(LS.players, players); }
function getSessionEmail(){ return localStorage.getItem(LS.sessionEmail)||""; }
function setSessionEmail(e){ localStorage.setItem(LS.sessionEmail, e); }
function clearSession(){ localStorage.removeItem(LS.sessionEmail); }

function getStats(){ return readJSON(LS.stats, {}); }      // { email: { shanghai: {...} } }
function saveStats(s){ writeJSON(LS.stats, s); }
function getHistory(){ return readJSON(LS.history, []); }  // [{gameId, players, startedAt, endedAt, summary}]
function saveHistory(h){ writeJSON(LS.history, h); }

/* ========= APP STATE ========= */
const app = document.getElementById("app");
const homeBtn = document.getElementById("homeBtn");
const signOutBtn = document.getElementById("signOutBtn");

let toastMsg = "";
let screen = "auth";          // auth | home | matchBuilder | game
let meEmail = getSessionEmail();
let currentGameId = null;
let match = null;             // active match state

homeBtn.onclick = () => {
  toastMsg = "";
  if(meEmail) { screen = "home"; match = null; currentGameId = null; }
  else { screen = "auth"; }
  render();
};
signOutBtn.onclick = () => {
  clearSession();
  meEmail = "";
  screen = "auth";
  match = null;
  currentGameId = null;
  toastMsg = "";
  render();
};

/* ========= GAMES REGISTRY (INSERTS) ========= */
const GAMES = {
  shanghai: {
    id: "shanghai",
    name: "Shanghai (Accuracy)",
    description: "Points: T=3, S=1, D=2, Miss=0. Target rotates 20→15→Bull. Shanghai bonus if you hit S+T+D with D as the 3rd dart.",
    targets: [20,19,18,17,16,15,"B"],
    initMatch(players){
      return {
        gameId:"shanghai",
        players: players.map(p=>({email:p.email, name:p.name, total:0})),
        turnIndex: 0,
        targetIndex: 0,
        dartInTurn: 0,         // 0..2
        // per player, per target: { throws: ["T","S","D" ...], points: n, shanghai: bool }
        grid: Object.fromEntries(players.map(p => [p.email, Object.fromEntries(GAMES.shanghai.targets.map(t => [String(t), {throws:[], points:0, shanghai:false}]))])),
        log: [],
        startedAt: now(),
        endedAt: null,
        finished: false
      };
    },
    pointsFor(hit){ return hit==="T"?3 : hit==="D"?2 : hit==="S"?1 : 0; },
    displayTarget(t){ return t==="B" ? "BULL" : String(t); },

    addThrow(state, hit){
      if(state.finished) return;
      const p = state.players[state.turnIndex];
      const tKey = String(GAMES.shanghai.targets[state.targetIndex]);
      const cell = state.grid[p.email][tKey];

      // record
      cell.throws.push(hit);
      cell.points += GAMES.shanghai.pointsFor(hit);
      p.total += GAMES.shanghai.pointsFor(hit);

      // shanghai check: must be exactly 3 darts, and D must be 3rd, and includes S+T+D
      if(cell.throws.length === 3){
        const a = cell.throws.slice();
        const hasS = a.includes("S");
        const hasT = a.includes("T");
        const hasD = a.includes("D");
        const dLast = a[2]==="D";
        if(hasS && hasT && hasD && dLast){
          cell.shanghai = true;
          // bonus
          cell.points += 5;
          p.total += 5;
          state.log.push({ts:now(), text:`${p.name} hit SHANGHAI on ${GAMES.shanghai.displayTarget(GAMES.shanghai.targets[state.targetIndex])}! (+5)`});
        }
      }

      state.log.push({ts:now(), text:`${p.name} @ ${GAMES.shanghai.displayTarget(GAMES.shanghai.targets[state.targetIndex])}: ${hit}`});

      state.dartInTurn++;
      if(state.dartInTurn >= 3){
        // end turn
        state.dartInTurn = 0;
        state.turnIndex = (state.turnIndex + 1) % state.players.length;

        // after everyone plays this target once, advance target
        // "round complete" when we wrap back to player 0
        if(state.turnIndex === 0){
          state.targetIndex++;
          if(state.targetIndex >= GAMES.shanghai.targets.length){
            state.finished = true;
            state.endedAt = now();
          }
        }
      }
    },

    undo(state){
      // Undo last logged throw (simple)
      if(state.finished && state.log.length===0) return;
      // Find last throw entry (not bonus line)
      for(let i=state.log.length-1;i>=0;i--){
        const txt = state.log[i].text || "";
        if(txt.includes(": T") || txt.includes(": S") || txt.includes(": D") || txt.includes(": M")){
          // parse
          const hit = txt.endsWith(" T") ? "T" : txt.endsWith(" S") ? "S" : txt.endsWith(" D") ? "D" : "M";
          // Determine which player/target it belonged to by reconstructing state:
          // We store enough to reverse by keeping a stack snapshot.
          // We will keep an internal stack for robust undo:
          break;
        }
      }
    }
  }
};

// Robust undo via snapshots
function pushSnap(){
  if(!match) return;
  match._snaps = match._snaps || [];
  // light snapshot (JSON)
  match._snaps.push(JSON.stringify(match));
  if(match._snaps.length > 60) match._snaps.shift();
}
function popSnap(){
  if(!match || !match._snaps || match._snaps.length===0) return false;
  // current snapshot includes _snaps; restore last prior state
  match._snaps.pop(); // remove current
  const prev = match._snaps.pop();
  if(!prev) return false;
  const restored = JSON.parse(prev);
  // keep history stack
  restored._snaps = (restored._snaps || []).concat([]); // ensure array
  match = restored;
  return true;
}

/* ========= AUTH + HOME FLOW ========= */
function findPlayerByEmail(email){
  const players = getPlayers();
  return players.find(p => p.email === normEmail(email)) || null;
}
function upsertPlayer(name, email){
  const e = normEmail(email);
  const players = getPlayers();
  const existing = players.find(p => p.email === e);
  if(existing){
    existing.name = name.trim() || existing.name;
  }else{
    players.push({name: name.trim(), email: e, createdAt: now()});
  }
  savePlayers(players);
  return players.find(p => p.email === e);
}

function signIn(email){
  const e = normEmail(email);
  if(!e || !e.includes("@")) { toastMsg = "Enter a valid email."; render(); return; }
  const p = findPlayerByEmail(e);
  if(!p){
    toastMsg = "No account found. Use Sign Up.";
    render();
    return;
  }
  meEmail = e;
  setSessionEmail(e);
  screen = "home";
  toastMsg = "";
  render();
}

function signUp(name,email){
  const n = (name||"").trim();
  const e = normEmail(email);
  if(!n){ toastMsg="Enter your name."; render(); return; }
  if(!e || !e.includes("@")) { toastMsg="Enter a valid email."; render(); return; }
  upsertPlayer(n,e);
  meEmail = e;
  setSessionEmail(e);
  screen = "home";
  toastMsg = "";
  render();
}

function me(){
  if(!meEmail) return null;
  return findPlayerByEmail(meEmail);
}

/* ========= MATCH BUILDER (1–4 PLAYERS) ========= */
function startPracticeSolo(){
  const p = me();
  if(!p){ toastMsg="Sign in first."; screen="auth"; render(); return; }
  const players = [{name:p.name,email:p.email}];
  startGame("shanghai", players);
}

function startPlayNow(){
  const p = me();
  if(!p){ toastMsg="Sign in first."; screen="auth"; render(); return; }
  screen = "matchBuilder";
  toastMsg = "";
  render();
}

function startGame(gameId, players){
  currentGameId = gameId;
  const mod = GAMES[gameId];
  match = mod.initMatch(players);
  // snapshots for undo
  match._snaps = [];
  pushSnap();
  screen = "game";
  toastMsg = "";
  render();
}

function endAndSaveMatch(){
  if(!match) return;
  // Save history + stats (local)
  const gameId = match.gameId;
  const stats = getStats();
  for(const p of match.players){
    stats[p.email] = stats[p.email] || {};
    stats[p.email][gameId] = stats[p.email][gameId] || {
      games:0,
      best:0,
      totalPoints:0,
      byTarget: {} // { "20": {S:0,D:0,T:0,M:0,points:0} ... }
    };
    const st = stats[p.email][gameId];
    st.games += 1;
    st.totalPoints += p.total;
    st.best = Math.max(st.best, p.total);

    // target breakdown
    const targets = GAMES[gameId].targets || [];
    for(const t of targets){
      const key = String(t);
      st.byTarget[key] = st.byTarget[key] || {S:0,D:0,T:0,M:0,points:0};
      const cell = match.grid[p.email][key];
      for(const h of cell.throws){
        if(h==="S"||h==="D"||h==="T"||h==="M") st.byTarget[key][h] += 1;
        st.byTarget[key].points += (h==="T"?3:h==="D"?2:h==="S"?1:0);
      }
      // include bonus if any
      if(cell.shanghai){ st.byTarget[key].points += 5; }
    }
  }
  saveStats(stats);

  const history = getHistory();
  history.unshift({
    gameId: match.gameId,
    players: match.players.map(p=>({name:p.name,email:p.email,total:p.total})),
    startedAt: match.startedAt,
    endedAt: match.endedAt || now(),
    summary: `${GAMES[match.gameId].name} • ${match.players.map(p=>`${p.name}: ${p.total}`).join(" | ")}`
  });
  if(history.length>100) history.length=100;
  saveHistory(history);
}

/* ========= GAME UI HANDLERS ========= */
function hit(h){
  if(!match) return;
  if(match.finished){ toastMsg="Game is finished."; render(); return; }
  pushSnap();
  GAMES[match.gameId].addThrow(match, h);
  if(match.finished){
    endAndSaveMatch();
  }
  render();
}
function undo(){
  if(!match) return;
  const ok = popSnap();
  if(!ok){ toastMsg="Nothing to undo."; }
  render();
}
function resetMatch(){
  if(!match) return;
  const players = match.players.map(p=>({name:p.name,email:p.email}));
  startGame(match.gameId, players);
}

/* ========= DARTBOARD SVG (REAL LOOK + ACTIVE WEDGE GLOW) ========= */
const BOARD_NUMS = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5]; // standard dartboard order
function polar(cx,cy,r,deg){
  const rad = (deg-90)*Math.PI/180;
  return {x: cx + r*Math.cos(rad), y: cy + r*Math.sin(rad)};
}
function arcWedgePath(cx,cy,r0,r1,a0,a1){
  const p1 = polar(cx,cy,r1,a0), p2 = polar(cx,cy,r1,a1);
  const p3 = polar(cx,cy,r0,a1), p4 = polar(cx,cy,r0,a0);
  const large = (a1-a0) > 180 ? 1 : 0;
  return [
    `M ${p1.x.toFixed(3)} ${p1.y.toFixed(3)}`,
    `A ${r1} ${r1} 0 ${large} 1 ${p2.x.toFixed(3)} ${p2.y.toFixed(3)}`,
    `L ${p3.x.toFixed(3)} ${p3.y.toFixed(3)}`,
    `A ${r0} ${r0} 0 ${large} 0 ${p4.x.toFixed(3)} ${p4.y.toFixed(3)}`,
    "Z"
  ].join(" ");
}
function dartboardSVG(activeNumber){
  // activeNumber: 20/19/18/17/16/15 or "B" (bull)
  const cx=100, cy=100;
  const outer=98, rDoubleOuter=92, rDoubleInner=84, rTripleOuter=62, rTripleInner=54, rSingleInner=16;
  const seg = 360/20;

  // find segment index
  const idx = (typeof activeNumber === "number") ? BOARD_NUMS.indexOf(activeNumber) : -1;
  const aMid = idx>=0 ? (idx*seg + seg/2) : null;

  // active highlight wedge on the big single area (between double inner and triple outer)
  let activePath = "";
  if(idx>=0){
    const a0 = idx*seg + 1.2;
    const a1 = (idx+1)*seg - 1.2;
    activePath = arcWedgePath(cx,cy,rTripleOuter+2,rDoubleInner-2,a0,a1);
  }

  const ringColorA = "#0b1220";
  const ringColorB = "#1a2338";

  return `
  <svg viewBox="0 0 200 200" width="94%" aria-label="dartboard">
    <defs>
      <radialGradient id="bgG" cx="50%" cy="42%" r="65%">
        <stop offset="0%" stop-color="#203a62"/>
        <stop offset="55%" stop-color="#0d1a2e"/>
        <stop offset="100%" stop-color="#060d18"/>
      </radialGradient>

      <filter id="glow" x="-30%" y="-30%" width="160%" height="160%">
        <feGaussianBlur stdDeviation="3.5" result="b"/>
        <feColorMatrix in="b" type="matrix"
          values="0 0 0 0 0.30
                  0 0 0 0 0.66
                  0 0 0 0 1.00
                  0 0 0 .9 0" result="c"/>
        <feMerge>
          <feMergeNode in="c"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>

      <filter id="softShadow" x="-30%" y="-30%" width="160%" height="160%">
        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#000" flood-opacity=".55"/>
      </filter>
    </defs>

    <circle cx="100" cy="100" r="${outer}" fill="url(#bgG)" stroke="#2a3f5f" stroke-width="2"/>

    ${activePath ? `<path d="${activePath}" fill="rgba(78,168,255,.16)" stroke="rgba(78,168,255,.55)" stroke-width="1.4" filter="url(#glow)"/>` : ""}

    <!-- base segments (simple alternating dark rings like a real board vibe) -->
    ${BOARD_NUMS.map((n,i)=>{
      const a0=i*seg, a1=(i+1)*seg;
      const fill = (i%2===0) ? ringColorA : ringColorB;
      const p = arcWedgePath(cx,cy,rTripleOuter,rDoubleInner,a0+0.7,a1-0.7);
      return `<path d="${p}" fill="${fill}" opacity="0.95"/>`;
    }).join("")}

    <!-- triple ring -->
    ${BOARD_NUMS.map((n,i)=>{
      const a0=i*seg, a1=(i+1)*seg;
      const fill = (i%2===0) ? "#2aa84a" : "#c63a3a";
      const p = arcWedgePath(cx,cy,rTripleInner,rTripleOuter,a0+0.9,a1-0.9);
      return `<path d="${p}" fill="${fill}" opacity="0.95"/>`;
    }).join("")}

    <!-- double ring -->
    ${BOARD_NUMS.map((n,i)=>{
      const a0=i*seg, a1=(i+1)*seg;
      const fill = (i%2===0) ? "#2aa84a" : "#c63a3a";
      const p = arcWedgePath(cx,cy,rDoubleInner,rDoubleOuter,a0+0.9,a1-0.9);
      return `<path d="${p}" fill="${fill}" opacity="0.95"/>`;
    }).join("")}

    <!-- inner single area -->
    ${BOARD_NUMS.map((n,i)=>{
      const a0=i*seg, a1=(i+1)*seg;
      const fill = (i%2===0) ? ringColorB : ringColorA;
      const p = arcWedgePath(cx,cy,rSingleInner,rTripleInner,a0+0.7,a1-0.7);
      return `<path d="${p}" fill="${fill}" opacity="0.95"/>`;
    }).join("")}

    <!-- bull -->
    <circle cx="100" cy="100" r="11.5" fill="#2aa84a" stroke="#1b2b42" stroke-width="2"/>
    <circle cx="100" cy="100" r="5.3" fill="#c63a3a" stroke="#1b2b42" stroke-width="1.5"/>

    <!-- number ring text -->
    ${BOARD_NUMS.map((n,i)=>{
      const ang=i*seg + seg/2;
      const p=polar(cx,cy,95,ang);
      return `<text x="${p.x.toFixed(2)}" y="${p.y.toFixed(2)}" text-anchor="middle" dominant-baseline="middle"
        font-size="8.5" fill="#dfe9ff" font-weight="900"
        transform="rotate(${ang} ${p.x.toFixed(2)} ${p.y.toFixed(2)}) rotate(${90-ang} ${p.x.toFixed(2)} ${p.y.toFixed(2)})"
        style="paint-order:stroke;stroke:#07101d;stroke-width:2px">${n}</text>`;
    }).join("")}

    <!-- outer rim -->
    <circle cx="100
