<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Game Night Darts</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg:#0b1a2e; --text:#eaf2ff; --muted:#b9cbe5; --accent:#4ea8ff;
  --danger:#ff4d5a; --ok:#2bd576; --shadow: rgba(0,0,0,.25);
}
*{box-sizing:border-box;}
body{
  margin:0; font-family:system-ui,sans-serif;
  background:radial-gradient(1200px 700px at 40% 0%, #10335f 0%, var(--bg) 55%);
  color:var(--text); min-height:100vh;
}
.topbar{
  position:sticky;top:0;z-index:10; display:flex;align-items:center;justify-content:space-between;
  padding:12px 14px;background:rgba(10,20,35,.8);backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(255,255,255,.1);
}
.brand .t{font-weight:900;font-size:16px}
.brand .s{font-size:11px;color:var(--muted)}
.btn{
  border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.08);
  color:var(--text); border-radius:12px; padding:10px 16px; font-weight:700; cursor:pointer;
}
.btn.ok{background:var(--ok); color:#000}
.wrap{max-width:800px;margin:0 auto;padding:14px}
.card{
  background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1);
  border-radius:18px; padding:20px; margin-bottom:16px;
}
.h1{font-size:22px;font-weight:900;margin-bottom:8px}
.sub{color:var(--muted);font-size:14px;margin-bottom:15px}
input{
  width:100%; background:rgba(0,0,0,.3); border:1px solid rgba(255,255,255,.2);
  color:#fff; padding:12px; border-radius:10px; margin-bottom:10px;
}
.divider{height:1px; background:rgba(255,255,255,.1); margin:15px 0}
.row{display:flex; gap:10px}
table{width:100%; border-collapse:collapse; font-size:14px}
th, td{padding:10px; border:1px solid rgba(255,255,255,.05); text-align:center}
.activeCell{background:rgba(78,168,255,.15); border:1px solid var(--accent)}
.boardBox{display:flex; justify-content:center; padding:20px 0}
.hitRow{display:flex; justify-content:center; gap:10px; margin:10px 0}
.hitBtn{width:50px; height:50px; border-radius:50%; border:none; font-weight:900; cursor:pointer}
/* Stats Bars */
.barRow{display:flex; align-items:center; gap:10px; margin-bottom:8px}
.barOuter{flex:1; height:12px; background:rgba(255,255,255,.1); border-radius:6px; overflow:hidden}
.barInner{height:100%; background:var(--accent)}
</style>
</head>
<body>

<div class="topbar">
  <div class="brand">
    <div class="t">Game Night Darts</div>
    <div class="s">Developed by Steveâ€™s Graphic Designs</div>
  </div>
  <button class="btn" id="navBtn">Home</button>
</div>

<div class="wrap" id="app"></div>

<script>
// ===== CONFIG & INIT =====
const firebaseConfig = { apiKey: "YOUR_KEY", projectId: "YOUR_ID" }; // Fill with your actual config
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let meUser = null;
let screen = "auth";
let match = null;
const TARGETS = [20,19,18,17,16,15,"B"];
const BOARD_NUMS = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];

// ===== CORE LOGIC =====
function esc(s){ return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;"); }
function now(){ return new Date().getTime(); }

async function render() {
  const appEl = document.getElementById("app");
  const navBtn = document.getElementById("navBtn");
  navBtn.style.display = meUser ? "block" : "none";
  navBtn.onclick = () => { screen = "home"; render(); };

  if (screen === "auth") {
    appEl.innerHTML = `
      <div class="card">
        <div class="h1">Sign In</div>
        <input id="inEmail" type="email" placeholder="Email Address">
        <button class="btn ok" id="goBtn">Continue</button>
      </div>`;
    document.getElementById("goBtn").onclick = async () => {
      const email = document.getElementById("inEmail").value.toLowerCase().trim();
      if (!email) return alert("Enter email");
      const doc = await db.collection("players").doc(email).get();
      if (doc.exists) { meUser = doc.data(); screen = "home"; } 
      else { meUser = { email }; screen = "signup"; }
      render();
    };
  } 
  
  else if (screen === "signup") {
    appEl.innerHTML = `
      <div class="card">
        <div class="h1">New Player</div>
        <input id="upName" type="text" placeholder="Your Display Name">
        <button class="btn ok" id="createBtn">Create Account</button>
      </div>`;
    document.getElementById("createBtn").onclick = async () => {
      const name = document.getElementById("upName").value.trim();
      if (!name) return alert("Enter name");
      await db.collection("players").doc(meUser.email).set({ name, email: meUser.email, createdAt: now() });
      meUser.name = name; screen = "home"; render();
    };
  }

  else if (screen === "home") {
    appEl.innerHTML = `
      <div class="card">
        <div class="h1">Welcome, ${esc(meUser.name)}</div>
        <div class="sub">Ready for a game?</div>
        <div class="row">
          <button class="btn ok" id="newGame">New Game</button>
          <button class="btn" id="viewStats">My Stats</button>
        </div>
      </div>`;
    document.getElementById("newGame").onclick = () => {
      match = newMatch([meUser]);
      screen = "play";
      render();
    };
    document.getElementById("viewStats").onclick = () => { screen = "stats"; render(); };
  }

  else if (screen === "play") {
    renderPlayScreen();
  }
}

// ===== GAMEPLAY HELPERS =====
function newMatch(players) {
  const grid = {};
  players.forEach(p => {
    grid[p.email] = {};
    TARGETS.forEach(t => grid[p.email][String(t)] = { throws: [], points: 0 });
  });
  return {
    players: players.map(p => ({ ...p, total: 0 })),
    turnIndex: 0, targetIndex: 0, dartInTurn: 0, grid, finished: false, startedAt: now(), snaps: []
  };
}

function renderPlayScreen() {
  const appEl = document.getElementById("app");
  const t = TARGETS[match.targetIndex];
  const activeP = match.players[match.turnIndex];

  appEl.innerHTML = `
    <div class="card">
      <div class="sub">Target: <b>${t}</b> | Player: <b>${activeP.name}</b></div>
      <div class="boardBox">${dartboardSVG(t)}</div>
      <div class="hitRow">
        <button class="btn" onclick="handleHit('T')">T</button>
        <button class="btn" onclick="handleHit('D')">D</button>
        <button class="btn" onclick="handleHit('S')">S</button>
        <button class="btn" onclick="handleHit('M')" style="background:var(--danger)">M</button>
      </div>
      <div class="divider"></div>
      <table>
        <thead><tr><th>Target</th><th>${activeP.name}</th></tr></thead>
        <tbody>
          ${TARGETS.map(trg => `
            <tr class="${trg === t ? 'activeCell' : ''}">
              <td>${trg}</td>
              <td>${match.grid[activeP.email][trg].points} pts</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>`;
}

window.handleHit = (hit) => {
  const p = match.players[match.turnIndex];
  const t = TARGETS[match.targetIndex];
  const val = hit === 'T' ? 3 : hit === 'D' ? 2 : hit === 'S' ? 1 : 0;
  
  match.grid[p.email][t].throws.push(hit);
  match.grid[p.email][t].points += val;
  p.total += val;
  match.dartInTurn++;

  if (match.dartInTurn >= 3) {
    match.dartInTurn = 0;
    match.targetIndex++;
    if (match.targetIndex >= TARGETS.length) {
      alert("Game Over! Total: " + p.total);
      screen = "home";
    }
  }
  render();
};

// Simplified SVG Generator
function dartboardSVG(active) {
  return `<svg viewBox="0 0 200 200" width="150"><circle cx="100" cy="100" r="80" fill="#1a2338" stroke="white"/><text x="100" y="110" text-anchor="middle" fill="white" font-size="40" font-weight="bold">${active}</text></svg>`;
}

render();
</script>
</body>
</html>
